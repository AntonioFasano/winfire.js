winfire.js
==========

[github.com/AntonioFasano/winfire.js](https://github.com/AntonioFasano/winfire.js)

This JScript script helps managing Windows Firewall, setting per per interface rules. 

It has been tested under Windows 7.  
Note: You need  elevated privileges to modify Windows Firewall settings and so for `winfire.js` too.


To add and enable the  rule `my-tcp-rule`, which opens listening TCP 2300 port on the Local Area Connection:


    winfire.js /rule-add /name:my-tcp-rule /prot-tcp /local-port:2300 /enab /interf:"Local Area Connection" /desc:"Rule added by winfire.js"

Note the colons after the options and quotations for including spaces.   
It possible to attach to rule to more interfaces with separating names with commas and *no spaces*, e.g.: `/interf:"Local Area Connection, Mobile Broadband Connection".


The connection name, which is localised based on your system language setting, can be  find in the Network Connection folder, perhaps opened with `ncpa.cpl`.  
Anyway you can get the full list  via:

    winfire.js /con-show

If you want to show the connection(s) with a specific substring (case insensitive), e.g. 'local'

    winfire.js /con-show:local

Eventually you can store the connection name identified by a substring in a variable for a cmd.exe batch job:

    for /F "tokens=*" %%i in ('winfire.js /con-show:local') do set LAN=%%i

(replace  `%%` with `%` for interactive)


If you want details on the rule just added (and the winfire.js did the job):

    winfire.js /rule-show /long:my-tcp-rule`

    my-tcp-rule                                 
    Description:    Rule added by winfire.js    
    Application Name:                           
    Service Name:                               
    Protocol:       TCP                         
    Local Ports:    2300                        
    Remote Ports:   *                           
    LocalAddresses: *                           
    RemoteAddresses:        *                   
    Direction:      In                          
    Enabled:        true                        
    Edge:   false                               
    Action: Allow                               
    Grouping:                                   
    Edge:   false                               
    Interface Types:        All                 
    Interfaces:     Local Area Connection 


To list all the rules relating to a specific connection use:

    winfire.js /rule-show:"Local Area Connection"

which here would return `my-tcp-rule`. 


If you want to list all rules in a grep friendly way:


    winfire.js /rule-show /grep>rules.txt

In this case you get every row, and therefore every rule field, prefixed with the rule name plus `==`.
So you can easily grep `rules.txt` rows and select the rows by rule.

Formal command reference
------------------------

The following is the output you might get from   `winfire.js /help`
    Manage Windows Firewall rules per interface
    by Antonio FASANO
    https://github.com/AntonioFasano/winfire.js
    
    winfire.js connection-name [options]
    Use double quotations for option values containing spaces: /opt:"my val"
    
    /h[elp]           This help
    /con-show[:SUB]   Show connection names [containing the substring SUB (ignoring case)]
    /prof-show        Show active profiles
    /rule-add         Add rule            
    /rule-del:NAME    Remove rule NAME
    /rule-show[:NAME] Show rules names [only if specific for interface/connection NAME]
    /long[:NAME]      With `/rule-show' use details [and rule NAME]
    /grep             With `/rule-show' prefix each row with rule name + `==' (for easy grep parsing)
    /sep              Separate rules in rule list with `===='
    
    `/rule-add' parameters
    /act-block        packets matching rule criteria rule are blocked
    /act-allow        packets matching rule criteria rule are permitted
    /app:APPNAME      traffic generated by APPNAME matches this rule. 
                      If `/app' is not given, any program matches this rule.
    /desc:NAME        the rule long decription
    /dir-in           matches inbound network traffic (See Inbound Rules of Advanced Firewall snap-in)
    /dir-out          matches outbound network traffic(See Outbound Rules of Advanced Firewall snap-in)
    /edge             traffic that traverses an edge device, such as a NAT enabled router between
                      the local and remote computer matches this rule. Valid only with /dir-in.
                      Cf. `Allow edge traversal` checkbox in the  Advanced Firewall  snap-in.
    /enab             is the rule is currently enabled?
    /group:NAME       Specifies a group name for a set of rules to modify together 
    /icmptype:LIST    list of ICMP types and codes separated by semicolon.
                      "*" indicates all ICMP types and codes.
    /interf:LIST      The connectio/interface list as from `/con-show' or the related Windows folder
                      Separate multiple values with a comma without extra space
    /itype-remote     packets passing through a RAS interface types match this rule     
    /itype-lan        packets passing through a lan interface types match this rule     
    /itype-wless      packets passing through a wireless interface types match this rule 
    /itype-all        packets passing through any interface types match this rule (default)
    /local-addr:ADDR  packets matching ADDR match this rule.
                      For inbound packets ADDR is matched againist the Destination IP field.
                      For outbound packets ADDR is matched againist the Source IP field.
                      ADDR can be
                      any:              matches any IP address
                      IPAddress:        matches only the exact IPv4 or IPv6 IP
                      "SUBNET/MASK":    matches any IPv4/IPv6 part of the SUBNET (mandatory quotes)
                                        MASK is the number of bits in the subnet mask or the subnet mask itself.
                      IPStart-IPEnd:     matches any IPv4/IPv6 falling within this range
                      Multiple entries can be specified in quotes and separating them with a comma and no spaces.
                      If `/local-addr' is not given the default is any.
    /local-port:PORT  packets with matching IP port numbers match this rule.
                      For inbound packets PORT is matched againist the Destination Port IP field.
                      For outbound packets PORT is matched againist the Source Port IP field.
                      PORT can be:
                      any:         matches any value in the port field of the IP packet.
                      Integer(s):  individual numbers from 0 through 65535, a range,
                                   or a comma-separated list of numbers and ranges.
                      rpc:         matches inbound TCP packets that are addressed to the listening socket
                                   of an application that correctly registers the port as an RPC listening
                                   port. A rule with this option must also give /prot-*, dir-* options
                                   and possibly /app or /service options
                      rpc-epmap:   matches inbound TCP packets that are addressed to the dynamic RPC
                                   endpoint mapper service.
                                   It needs the same companion options as `rpc' value' In paricular,
                                   (to ensure only the RPC service can send/receive data) use:,
                                   `/app:%windir%system32svchost.exe /service:rpcss'
                                   If you create a rule /local-port:rpc, then you must also create a rule
                                   with `/local-port:rpc-epmap` enabled, to allow both the incoming request
                                   to the mapper, and the subsequent packets to the ephemeral ports
                                   assigned by the RPC service.
                      Teredo:      Matches inbound UDP packets that contain Teredo packets.
                      iphttps:     Matches inbound TCP packets containing HTTPS with embedded IPv6 packets.
                                   iphttps allows IPv6 packets that would otherwise be blocked if sent by
                                   using Teredo, 6to4, or native IPv6.
                      Multiple entries can be specified in quotes and separating them with a comma and no spaces
                      If `/local-port' is not specified, the default is any
    /name:NAME        Specifies the name of this firewall rule. 
    /prof-domain      The rule is assigned to the domain profile (*)
    /prof-private     The rule is assigned to the private profile(*)
    /prof-public      The rule is assigned to the public profile (*)
                      (*) The rule will be active if/when  the related  profile is such.
                          If a profile is not specified, the rule is active on any profile.
    /prot-tcp         packets whose protocol field tcp match this rule
    /prot-udp         packets whose protocol field udp match this rule
    /prot-icmpv4      packets whose protocol field icmpv4 match this rule
    /prot-icmpv6      packets whose protocol field icmpv6 match this rule
    /remo-addr:ADDR   packets matching remote ADDR match this rule.
                      for outbound packets ADDR is compared to the Destination IP address field
                      for inbound packets ADDR is compared to the Source IP address field
                      ADDR can be
                      any:          Matches any IP address
                      localsubnet:  Matches any IP address on the same IP subnet as the local computer
                      dns|dhcp|wins|defaultgateway: Matches the IP address of any computer configured as
                                                    dns, dhcp, wins, default gateway on the local computer
                      IPAddress, "SUBNET/MASK", IPStart-IPEnd:  See `/local-addr'
                      Multiple entries can be specified as with `/local-addr'
    /remo-port:PORT   packets with matching IP port numbers match this rule.
                      For inbound packets PORT is matched againist the Source Port IP field.
                      For outbound packets PORT is matched againist the Destination Port IP field.
                      PORT can be:
                      any:  Matches any value in the port field of the IP packet
                      Integer(s):  individual numbers from 0 through 65535, a range,
                                   or a comma-separated list of numbers and ranges.
                      Multiple entries can be specified in quotes and separating them with a comma and no spaces
                      If `/remo-port' is not specified, the default is any
    /service:SERVICE  traffic generated by service SERVICE matches this rule.
                      SERVICE is the short name from Services snap-in
                      If `/service' is not given, any service matches this rule.
                      If SERVICE is "*", then any service, but  not an application, matches this rule
    